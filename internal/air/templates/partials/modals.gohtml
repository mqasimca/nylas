{{define "modals"}}
<!-- Command Palette -->
<div class="modal-overlay hidden" id="commandPalette" data-testid="command-palette" onclick="toggleCommandPalette()">
    <div class="command-palette" onclick="event.stopPropagation()">
        <div class="command-input-wrapper">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
            </svg>
            <input type="text" class="command-input" data-testid="command-palette-input" placeholder="Type a command or search..." autofocus>
        </div>
        <div class="command-results">
            <div class="command-section">
                <div class="command-section-title">Quick Actions</div>
                <div class="command-item selected">
                    <div class="command-icon-wrapper">‚úâÔ∏è</div>
                    <div class="command-text">
                        <div class="command-title">Compose new email</div>
                        <div class="command-description">Start writing a new message</div>
                    </div>
                    <div class="command-shortcut"><kbd>C</kbd></div>
                </div>
                <div class="command-item">
                    <div class="command-icon-wrapper">üìÖ</div>
                    <div class="command-text">
                        <div class="command-title">Create event</div>
                        <div class="command-description">Add a new calendar event</div>
                    </div>
                    <div class="command-shortcut"><kbd>‚áß</kbd><kbd>C</kbd></div>
                </div>
                <div class="command-item">
                    <div class="command-icon-wrapper">üéØ</div>
                    <div class="command-text">
                        <div class="command-title">Find meeting time</div>
                        <div class="command-description">Find optimal time across timezones</div>
                    </div>
                </div>
                <div class="command-item">
                    <div class="command-icon-wrapper">üßò</div>
                    <div class="command-text">
                        <div class="command-title">Block focus time</div>
                        <div class="command-description">Protect time for deep work</div>
                    </div>
                </div>
            </div>
            <div class="command-section">
                <div class="command-section-title">AI Features</div>
                <div class="command-item">
                    <div class="command-icon-wrapper">‚ú®</div>
                    <div class="command-text">
                        <div class="command-title">Smart Compose</div>
                        <div class="command-description">AI-powered email drafting</div>
                    </div>
                </div>
                <div class="command-item">
                    <div class="command-icon-wrapper">üìù</div>
                    <div class="command-text">
                        <div class="command-title">Summarize thread</div>
                        <div class="command-description">Get AI summary of conversation</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Search Overlay -->
<div class="search-overlay" id="searchOverlay" data-testid="search-overlay" onclick="if(event.target === this) closeSearch()">
    <div class="search-modal" onclick="event.stopPropagation()">
        <div class="search-input-wrapper">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
            </svg>
            <input type="text" id="searchInput" class="search-input" data-testid="search-input" placeholder="Search emails, events, contacts..."
                   oninput="handleSearchInput(this.value)" onkeydown="handleSearchKeydown(event)">
            <kbd class="search-kbd">ESC</kbd>
        </div>
        <div class="search-filters">
            <button class="search-filter-chip active" onclick="toggleSearchFilter(this)" data-filter="all">
                All
            </button>
            <button class="search-filter-chip" onclick="toggleSearchFilter(this)" data-filter="emails">
                <span>üìß</span> Emails
            </button>
            <button class="search-filter-chip" onclick="toggleSearchFilter(this)" data-filter="events">
                <span>üìÖ</span> Events
            </button>
            <button class="search-filter-chip" onclick="toggleSearchFilter(this)" data-filter="contacts">
                <span>üë§</span> Contacts
            </button>
            <button class="search-filter-chip" onclick="toggleSearchFilter(this)" data-filter="attachments">
                <span>üìé</span> Attachments
            </button>
        </div>
        <div class="search-suggestions" id="searchSuggestions">
            <!-- Recent searches section - populated by JavaScript -->
            <div class="search-suggestion-group" id="recentSearchesGroup">
                <div class="search-suggestion-title">
                    <span>Recent Searches</span>
                    <button class="clear-recent-btn" onclick="RecentSearches.clear()" title="Clear recent searches">Clear</button>
                </div>
                <div id="recentSearchesList">
                    <!-- Recent searches will be rendered here -->
                </div>
            </div>
            <!-- Search results section -->
            <div id="searchResultsSection"></div>
        </div>
    </div>
</div>

<!-- Compose Modal -->
<div class="compose-modal hidden" id="composeModal" data-testid="compose-modal" style="display:none" aria-hidden="true" role="dialog" aria-labelledby="composeTitle">
    <div class="compose-header">
        <span class="compose-title" id="composeTitle">New Message</span>
        <div class="compose-controls">
            <button class="compose-control" type="button" title="Minimize">‚àí</button>
            <button class="compose-control modal-close" type="button" title="Close" data-testid="compose-close">√ó</button>
        </div>
    </div>
    <form id="composeForm" class="compose-form">
        <div class="compose-fields">
            <div class="compose-field">
                <label class="compose-label" for="composeTo">To</label>
                <input type="text" id="composeTo" class="compose-field-input" data-testid="compose-to" placeholder="Recipients (comma separated)" autocomplete="email">
            </div>
            <div class="compose-field compose-field-collapsed" id="ccBccToggle" data-testid="compose-cc-bcc-toggle">
                <button type="button" class="compose-cc-toggle" onclick="toggleCcBcc()">Cc/Bcc</button>
            </div>
            <div class="compose-field compose-field-cc hidden" id="ccField" data-testid="compose-cc-field">
                <label class="compose-label" for="composeCc">Cc</label>
                <input type="text" id="composeCc" class="compose-field-input" data-testid="compose-cc" placeholder="Cc recipients">
            </div>
            <div class="compose-field compose-field-bcc hidden" id="bccField" data-testid="compose-bcc-field">
                <label class="compose-label" for="composeBcc">Bcc</label>
                <input type="text" id="composeBcc" class="compose-field-input" data-testid="compose-bcc" placeholder="Bcc recipients">
            </div>
            <div class="compose-field">
                <label class="compose-label" for="composeSubject">Subject</label>
                <input type="text" id="composeSubject" class="compose-field-input" data-testid="compose-subject" placeholder="Subject">
            </div>
        </div>
        <div class="compose-body">
            <textarea id="composeBody" class="compose-editor" data-testid="compose-body" placeholder="Write your message..."></textarea>
        </div>
    </form>
    <div class="compose-footer">
        <div class="compose-tools">
            <button type="button" class="tool-btn" id="composeSave" title="Save draft">üíæ</button>
            <button type="button" class="tool-btn" title="Attach file">üìé</button>
            <button type="button" class="tool-btn" title="Insert link">üîó</button>
            <button type="button" class="tool-btn" title="Insert emoji">üòä</button>
            <!-- Templates button disabled: <button type="button" class="tool-btn" onclick="TemplatesManager.open()" title="Templates">üìã</button> -->
            <button type="button" class="tool-btn ai" title="AI Compose">‚ú®</button>
            <button type="button" class="tool-btn danger" id="composeDiscard" title="Discard">üóëÔ∏è</button>
        </div>
        <div class="send-group" style="display: flex;">
            <button type="button" class="send-btn" id="composeSend" data-testid="compose-send">
                Send
                <span class="send-shortcut">‚åò‚Üµ</span>
            </button>
        </div>
    </div>
</div>

<script>
function toggleCcBcc() {
    const ccField = document.getElementById('ccField');
    const bccField = document.getElementById('bccField');
    const toggle = document.getElementById('ccBccToggle');
    ccField.classList.remove('hidden');
    bccField.classList.remove('hidden');
    toggle.classList.add('hidden');
}
</script>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer" data-testid="toast-container"></div>

<!-- Send Animation -->
<div class="send-animation" id="sendAnimation">
    <div class="send-animation-icon">‚úàÔ∏è</div>
    <div class="send-animation-text">Message Sent</div>
</div>

<!-- Focus Mode Toggle -->
<button class="focus-mode-toggle" id="focusModeToggle" onclick="toggleFocusMode()">
    <span>üéØ</span>
    <span>Focus Mode</span>
    <kbd style="font-size: 10px; padding: 2px 6px; background: var(--bg-surface); border-radius: 4px;">F</kbd>
</button>

<!-- Keyboard Shortcut Overlay -->
<div class="shortcut-overlay" id="shortcutOverlay" data-testid="shortcut-overlay" onclick="if(event.target === this) closeShortcutOverlay()">
    <div class="shortcut-modal">
        <div class="shortcut-header">
            <h2 class="shortcut-title">‚å®Ô∏è Keyboard Shortcuts</h2>
            <button class="shortcut-close" data-testid="shortcut-close" onclick="closeShortcutOverlay()">‚úï</button>
        </div>
        <div class="shortcut-content">
            <div class="shortcut-group">
                <div class="shortcut-group-title">Navigation</div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Next email</span>
                    <div class="shortcut-keys"><span class="shortcut-key">J</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Previous email</span>
                    <div class="shortcut-keys"><span class="shortcut-key">K</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Open email</span>
                    <div class="shortcut-keys"><span class="shortcut-key">O</span> or <span class="shortcut-key">‚Üµ</span></div>
                </div>
            </div>
            <div class="shortcut-group">
                <div class="shortcut-group-title">Actions</div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Compose</span>
                    <div class="shortcut-keys"><span class="shortcut-key">C</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Reply</span>
                    <div class="shortcut-keys"><span class="shortcut-key">R</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Archive</span>
                    <div class="shortcut-keys"><span class="shortcut-key">E</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Delete</span>
                    <div class="shortcut-keys"><span class="shortcut-key">#</span></div>
                </div>
            </div>
            <div class="shortcut-group">
                <div class="shortcut-group-title">Application</div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Search</span>
                    <div class="shortcut-keys"><span class="shortcut-key">‚åò</span><span class="shortcut-key">K</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Focus mode</span>
                    <div class="shortcut-keys"><span class="shortcut-key">‚áß</span><span class="shortcut-key">F</span></div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-label">Show shortcuts</span>
                    <div class="shortcut-keys"><span class="shortcut-key">?</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Context Menu -->
<div class="context-menu" id="contextMenu" data-testid="context-menu">
    <div class="context-menu-item" onclick="handleContextAction('reply')">
        <span class="context-menu-icon">‚Ü©Ô∏è</span>
        <span>Reply</span>
        <span class="context-menu-shortcut">R</span>
    </div>
    <div class="context-menu-item" onclick="handleContextAction('forward')">
        <span class="context-menu-icon">‚Ü™Ô∏è</span>
        <span>Forward</span>
        <span class="context-menu-shortcut">F</span>
    </div>
    <div class="context-menu-divider"></div>
    <!-- Snooze disabled
    <div class="context-menu-item" onclick="SnoozeManager.openForEmail(window.contextMenuEmailId)">
        <span class="context-menu-icon">‚è∞</span>
        <span>Snooze</span>
        <span class="context-menu-shortcut">Z</span>
    </div>
    -->
    <div class="context-menu-item" onclick="handleContextAction('archive')">
        <span class="context-menu-icon">üì•</span>
        <span>Archive</span>
        <span class="context-menu-shortcut">E</span>
    </div>
    <div class="context-menu-item" onclick="handleContextAction('star')">
        <span class="context-menu-icon">‚≠ê</span>
        <span>Star</span>
        <span class="context-menu-shortcut">S</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item danger" onclick="handleContextAction('delete')">
        <span class="context-menu-icon">üóëÔ∏è</span>
        <span>Delete</span>
        <span class="context-menu-shortcut">#</span>
    </div>
</div>

<!-- Event Modal -->
<div class="event-modal-overlay hidden" id="eventModalOverlay" onclick="if(event.target === this) closeEventModal()">
    <div class="event-modal" role="dialog" aria-labelledby="eventModalTitle" aria-modal="true">
        <div class="event-modal-header">
            <h2 id="eventModalTitle">New Event</h2>
            <button class="event-modal-close" onclick="closeEventModal()" aria-label="Close">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <form id="eventForm" class="event-form">
            <input type="hidden" id="eventId" value="">
            <input type="hidden" id="eventCalendarId" value="">

            <div class="event-form-group">
                <label for="eventTitle" class="event-label">Title</label>
                <input type="text" id="eventTitle" class="event-input" placeholder="Add title" required>
            </div>

            <div class="event-form-row">
                <div class="event-form-group">
                    <label for="eventStartDate" class="event-label">Start</label>
                    <div class="event-datetime-inputs">
                        <input type="date" id="eventStartDate" class="event-input event-date-input" required>
                        <input type="time" id="eventStartTime" class="event-input event-time-input" value="09:00">
                    </div>
                </div>
                <div class="event-form-group">
                    <label for="eventEndDate" class="event-label">End</label>
                    <div class="event-datetime-inputs">
                        <input type="date" id="eventEndDate" class="event-input event-date-input" required>
                        <input type="time" id="eventEndTime" class="event-input event-time-input" value="10:00">
                    </div>
                </div>
            </div>

            <div class="event-form-group event-checkbox-group">
                <label class="event-checkbox-label">
                    <input type="checkbox" id="eventAllDay" onchange="toggleAllDay()">
                    <span>All day</span>
                </label>
            </div>

            <div class="event-form-group">
                <label for="eventLocation" class="event-label">Location</label>
                <input type="text" id="eventLocation" class="event-input" placeholder="Add location">
            </div>

            <div class="event-form-group">
                <label for="eventDescription" class="event-label">Description</label>
                <textarea id="eventDescription" class="event-textarea" placeholder="Add description" rows="3"></textarea>
            </div>

            <div class="event-form-group">
                <label for="eventParticipants" class="event-label">Guests</label>
                <input type="text" id="eventParticipants" class="event-input" placeholder="Add guests (comma-separated emails)">
            </div>

            <div class="event-form-group event-checkbox-group">
                <label class="event-checkbox-label">
                    <input type="checkbox" id="eventBusy" checked>
                    <span>Show as busy</span>
                </label>
            </div>
        </form>
        <div class="event-modal-footer">
            <button type="button" class="event-btn event-btn-secondary" onclick="closeEventModal()">Cancel</button>
            <button type="button" class="event-btn event-btn-danger hidden" id="eventDeleteBtn" onclick="deleteEvent()">Delete</button>
            <button type="button" class="event-btn event-btn-primary" id="eventSaveBtn" onclick="saveEvent()">Save</button>
        </div>
    </div>
</div>

<!-- Contact Modal -->
<div class="contact-modal-overlay hidden" id="contactModalOverlay" onclick="if(event.target === this) ContactsManager.closeModal()">
    <div class="contact-modal" role="dialog" aria-labelledby="contactModalTitle" aria-modal="true">
        <div class="contact-modal-header">
            <h2 id="contactModalTitle">New Contact</h2>
            <button class="contact-modal-close" onclick="ContactsManager.closeModal()" aria-label="Close">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <form id="contactForm" class="contact-form">
            <input type="hidden" id="contactId" value="">

            <div class="contact-form-row">
                <div class="contact-form-group">
                    <label for="contactGivenName" class="contact-label">First Name</label>
                    <input type="text" id="contactGivenName" class="contact-input" placeholder="First name">
                </div>
                <div class="contact-form-group">
                    <label for="contactSurname" class="contact-label">Last Name</label>
                    <input type="text" id="contactSurname" class="contact-input" placeholder="Last name">
                </div>
            </div>

            <div class="contact-form-group">
                <label for="contactNickname" class="contact-label">Nickname</label>
                <input type="text" id="contactNickname" class="contact-input" placeholder="Nickname">
            </div>

            <div class="contact-form-group">
                <label class="contact-label">Email Addresses</label>
                <div id="contactEmails" class="contact-multi-input">
                    <div class="contact-multi-row">
                        <input type="email" class="contact-input contact-email-input" placeholder="Email address">
                        <select class="contact-type-select">
                            <option value="personal">Personal</option>
                            <option value="work">Work</option>
                            <option value="other">Other</option>
                        </select>
                        <button type="button" class="contact-add-btn" onclick="ContactsManager.addEmailRow()">+</button>
                    </div>
                </div>
            </div>

            <div class="contact-form-group">
                <label class="contact-label">Phone Numbers</label>
                <div id="contactPhones" class="contact-multi-input">
                    <div class="contact-multi-row">
                        <input type="tel" class="contact-input contact-phone-input" placeholder="Phone number">
                        <select class="contact-type-select">
                            <option value="mobile">Mobile</option>
                            <option value="home">Home</option>
                            <option value="work">Work</option>
                            <option value="other">Other</option>
                        </select>
                        <button type="button" class="contact-add-btn" onclick="ContactsManager.addPhoneRow()">+</button>
                    </div>
                </div>
            </div>

            <div class="contact-form-row">
                <div class="contact-form-group">
                    <label for="contactCompany" class="contact-label">Company</label>
                    <input type="text" id="contactCompany" class="contact-input" placeholder="Company">
                </div>
                <div class="contact-form-group">
                    <label for="contactJobTitle" class="contact-label">Job Title</label>
                    <input type="text" id="contactJobTitle" class="contact-input" placeholder="Job title">
                </div>
            </div>

            <div class="contact-form-group">
                <label for="contactNotes" class="contact-label">Notes</label>
                <textarea id="contactNotes" class="contact-textarea" placeholder="Add notes" rows="3"></textarea>
            </div>

            <div class="contact-form-group">
                <label for="contactBirthday" class="contact-label">Birthday</label>
                <input type="date" id="contactBirthday" class="contact-input">
            </div>
        </form>
        <div class="contact-modal-footer">
            <button type="button" class="contact-btn contact-btn-secondary" onclick="ContactsManager.closeModal()">Cancel</button>
            <button type="button" class="contact-btn contact-btn-primary" id="contactSaveBtn" onclick="ContactsManager.saveContact()">Save</button>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="settings-overlay" id="settingsOverlay" data-testid="settings-overlay" onclick="closeSettingsOnOverlay(event)">
    <div class="settings-modal">
        <div class="settings-header">
            <h2>Settings</h2>
            <button class="settings-close-btn" data-testid="settings-close" onclick="toggleSettings()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="settings-content">
            <!-- AI Provider Section -->
            <div class="settings-section" data-testid="settings-ai-section">
                <h3 class="settings-section-title">
                    <span class="settings-section-icon">‚ú®</span>
                    AI Provider
                </h3>
                <p class="settings-section-desc">Choose which AI provider to use for email summaries and smart replies</p>
                <div class="settings-options">
                    <label class="settings-option" data-provider="claude-code">
                        <input type="radio" name="ai-provider" value="claude-code">
                        <div class="option-content">
                            <div class="option-icon claude-icon">C</div>
                            <div class="option-details">
                                <div class="option-name">Claude Code</div>
                                <div class="option-desc">Anthropic's Claude via MCP integration</div>
                            </div>
                        </div>
                    </label>
                </div>
                <p class="settings-section-hint" style="margin-top: 12px; font-size: 12px; color: var(--text-muted);">
                    üí° Use Claude Code CLI with the Nylas MCP server for AI-powered email features.
                </p>
            </div>

            <!-- Notetaker Section -->
            <div class="settings-section">
                <h3 class="settings-section-title">
                    <span class="settings-section-icon">üéôÔ∏è</span>
                    Notetaker Sources
                </h3>
                <p class="settings-section-desc">Configure email sources for meeting recordings. Add multiple sources to aggregate recordings from different notetaker services.</p>

                <div class="notetaker-sources-list" id="notetakerSourcesList">
                    <!-- Sources will be rendered by JavaScript -->
                </div>

                <button class="settings-add-source-btn" onclick="openAddNotetakerSourceModal()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 5v14m-7-7h14"/>
                    </svg>
                    Add Source
                </button>
            </div>

            <!-- Theme Section -->
            <div class="settings-section" data-testid="settings-theme-section">
                <h3 class="settings-section-title">
                    <span class="settings-section-icon">üé®</span>
                    Appearance
                </h3>
                <p class="settings-section-desc">Customize the look and feel</p>
                <div class="settings-subsection">
                    <div class="settings-label">Theme Mode</div>
                    <div class="theme-toggle-group">
                        <button class="theme-btn" data-theme="light" onclick="setTheme('light')">Light</button>
                        <button class="theme-btn active" data-theme="dark" onclick="setTheme('dark')">Dark</button>
                        <button class="theme-btn" data-theme="system" onclick="setTheme('system')">System</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="settings-footer">
            <button class="settings-reset-btn" onclick="resetSettings()">Reset to Defaults</button>
            <button class="settings-save-btn" onclick="saveSettings()">Save Changes</button>
        </div>
    </div>
</div>

<!-- Snooze Picker Modal -->
<div class="snooze-picker-overlay hidden" id="snoozePickerOverlay" onclick="if(event.target === this) closeSnoozeModal()">
    <div class="snooze-picker-modal">
        <div class="snooze-picker-header">
            <h3>Snooze until...</h3>
            <button class="snooze-picker-close" onclick="closeSnoozeModal()">√ó</button>
        </div>
        <div class="snooze-options">
            <button class="snooze-option" onclick="snoozeEmail('later_today')">
                <span class="snooze-option-icon">üåÜ</span>
                <div class="snooze-option-text">
                    <span class="snooze-option-label">Later today</span>
                    <span class="snooze-option-time" id="snoozeLaterToday">6:00 PM</span>
                </div>
            </button>
            <button class="snooze-option" onclick="snoozeEmail('tomorrow')">
                <span class="snooze-option-icon">üåÖ</span>
                <div class="snooze-option-text">
                    <span class="snooze-option-label">Tomorrow</span>
                    <span class="snooze-option-time" id="snoozeTomorrow">9:00 AM</span>
                </div>
            </button>
            <button class="snooze-option" onclick="snoozeEmail('next_week')">
                <span class="snooze-option-icon">üìÖ</span>
                <div class="snooze-option-text">
                    <span class="snooze-option-label">Next week</span>
                    <span class="snooze-option-time" id="snoozeNextWeek">Monday 9:00 AM</span>
                </div>
            </button>
            <button class="snooze-option" onclick="snoozeEmail('weekend')">
                <span class="snooze-option-icon">üèñÔ∏è</span>
                <div class="snooze-option-text">
                    <span class="snooze-option-label">This weekend</span>
                    <span class="snooze-option-time" id="snoozeWeekend">Saturday 10:00 AM</span>
                </div>
            </button>
        </div>
        <div class="snooze-custom">
            <button class="snooze-custom-btn" onclick="openCustomSnooze()">
                <span>üìÜ</span> Pick date & time
            </button>
        </div>
    </div>
</div>

<!-- Send Later Picker Modal -->
<div class="send-later-overlay hidden" id="sendLaterOverlay" onclick="if(event.target === this) closeSendLaterModal()">
    <div class="send-later-modal">
        <div class="send-later-header">
            <h3>Schedule send</h3>
            <button class="send-later-close" onclick="closeSendLaterModal()">√ó</button>
        </div>
        <div class="send-later-options">
            <button class="send-later-option" onclick="scheduleSend('tomorrow_morning')">
                <span class="send-later-icon">üåÖ</span>
                <div class="send-later-text">
                    <span class="send-later-label">Tomorrow morning</span>
                    <span class="send-later-time">8:00 AM</span>
                </div>
            </button>
            <button class="send-later-option" onclick="scheduleSend('tomorrow_afternoon')">
                <span class="send-later-icon">üåá</span>
                <div class="send-later-text">
                    <span class="send-later-label">Tomorrow afternoon</span>
                    <span class="send-later-time">1:00 PM</span>
                </div>
            </button>
            <button class="send-later-option" onclick="scheduleSend('next_monday')">
                <span class="send-later-icon">üìÖ</span>
                <div class="send-later-text">
                    <span class="send-later-label">Monday morning</span>
                    <span class="send-later-time">8:00 AM</span>
                </div>
            </button>
        </div>
        <div class="send-later-custom">
            <label class="send-later-custom-label">Custom date & time</label>
            <div class="send-later-custom-inputs">
                <input type="date" id="sendLaterDate" class="send-later-date-input">
                <input type="time" id="sendLaterTime" class="send-later-time-input" value="09:00">
            </div>
            <button class="send-later-schedule-btn" onclick="scheduleCustomSend()">
                Schedule
            </button>
        </div>
    </div>
</div>

<script>
// Snooze Modal Functions
function closeSnoozeModal() {
    document.getElementById('snoozePickerOverlay').classList.add('hidden');
}

function openSnoozeModal(emailId) {
    window.snoozeEmailId = emailId;
    updateSnoozeTimes();
    document.getElementById('snoozePickerOverlay').classList.remove('hidden');
}

function updateSnoozeTimes() {
    const now = new Date();

    // Later today (6 PM)
    const laterToday = new Date(now);
    laterToday.setHours(18, 0, 0, 0);
    if (laterToday <= now) laterToday.setDate(laterToday.getDate() + 1);
    document.getElementById('snoozeLaterToday').textContent = laterToday.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

    // Tomorrow (9 AM)
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(9, 0, 0, 0);
    document.getElementById('snoozeTomorrow').textContent = 'Tomorrow ' + tomorrow.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

    // Next week (Monday 9 AM)
    const nextWeek = new Date(now);
    const daysUntilMonday = (8 - now.getDay()) % 7 || 7;
    nextWeek.setDate(nextWeek.getDate() + daysUntilMonday);
    nextWeek.setHours(9, 0, 0, 0);
    document.getElementById('snoozeNextWeek').textContent = 'Monday ' + nextWeek.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

    // Weekend (Saturday 10 AM)
    const weekend = new Date(now);
    const daysUntilSat = (6 - now.getDay() + 7) % 7 || 7;
    weekend.setDate(weekend.getDate() + daysUntilSat);
    weekend.setHours(10, 0, 0, 0);
    document.getElementById('snoozeWeekend').textContent = 'Sat ' + weekend.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
}

function snoozeEmail(option) {
    console.log('Snoozing email:', window.snoozeEmailId, 'until:', option);
    showToast('Email snoozed', 'success');
    closeSnoozeModal();
}

function openCustomSnooze() {
    console.log('Opening custom snooze picker');
}

// Send Later Modal Functions
function closeSendLaterModal() {
    document.getElementById('sendLaterOverlay').classList.add('hidden');
}

function openSendLaterModal() {
    // Set default date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('sendLaterDate').value = tomorrow.toISOString().split('T')[0];
    document.getElementById('sendLaterOverlay').classList.remove('hidden');
}

function scheduleSend(option) {
    console.log('Scheduling send:', option);
    showToast('Email scheduled', 'success');
    closeSendLaterModal();
}

function scheduleCustomSend() {
    const date = document.getElementById('sendLaterDate').value;
    const time = document.getElementById('sendLaterTime').value;
    console.log('Scheduling custom send:', date, time);
    showToast('Email scheduled for ' + new Date(date + 'T' + time).toLocaleString(), 'success');
    closeSendLaterModal();
}
</script>

<!-- Add Notetaker Source Modal -->
<div class="notetaker-source-modal-overlay hidden" id="notetakerSourceModal" onclick="if(event.target === this) closeNotetakerSourceModal()">
    <div class="notetaker-source-modal">
        <div class="notetaker-source-modal-header">
            <h3 id="notetakerSourceModalTitle">Add Notetaker Source</h3>
            <button class="notetaker-source-modal-close" onclick="closeNotetakerSourceModal()">√ó</button>
        </div>
        <div class="notetaker-source-modal-body">
            <input type="hidden" id="notetakerSourceEditIndex" value="-1">
            <div class="form-group">
                <label for="notetakerSourceFrom">From Email</label>
                <input type="email" id="notetakerSourceFrom" class="form-input" placeholder="e.g., recordings@example.com">
                <p class="form-hint">The sender email address for notetaker summary emails</p>
            </div>
            <div class="form-group">
                <label for="notetakerSourceSubject">Subject Filter (Optional)</label>
                <input type="text" id="notetakerSourceSubject" class="form-input" placeholder="e.g., Meeting Summary">
                <p class="form-hint">Filter by subject line (leave empty to include all)</p>
            </div>
            <div class="form-group">
                <label for="notetakerSourceLink">External Link Domain</label>
                <input type="text" id="notetakerSourceLink" class="form-input" placeholder="e.g., recordings.example.com">
                <p class="form-hint">The domain for recording links (e.g., recordings.example.com)</p>
            </div>
        </div>
        <div class="notetaker-source-modal-footer">
            <button class="btn-secondary" onclick="closeNotetakerSourceModal()">Cancel</button>
            <button class="btn-primary" onclick="saveNotetakerSource()">Save</button>
        </div>
    </div>
</div>
{{end}}
